sudo: required

language: node_js

node_js:
- 9

env:
- DOCKER_REPO=gorillab/reader-admin

jobs:
  include:
  - stage: test
    install:
    - yarn
    script:
    - yarn test
  - stage: build
    services:
    - docker
    install:
    - yarn
    script:
    - yarn build
    - docker build -t "$DOCKER_REPO" .
    - if [ ! -z "$TRAVIS_TAG" ]; then docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD";
      for TAG in {"$TRAVIS_TAG",latest}; do docker tag "$DOCKER_REPO" "$DOCKER_REPO":"$TAG";
      docker push "$DOCKER_REPO":"$TAG"; done fi

cache:
  yarn: true
  directories:
  - node_modules

notifications:
  email: false
  slack:
    secure: YMnOhCi7/jlQNqtihVqquf+RHNlHNZFSPi8/6pja7I+rilfEkNzBlH4qLh3lPsG53OlihEO0c53X6KdFZ5judV7FkpRmSDiHtSpmNDHzbkowjzU2WUXHbEpT9gqwF1kxnLcD3bb2PZltmCjGH0ru+gNmOCBf0OVZf4sR1vblHcp9IMslEsk0NTZRMgqB11CZ0n4kkG/zrQXdgYXVIHdK+nzLnZAO2u3mHVQwMCWHrcC/hZPrtqssz0xsiyEdSF47pMCp4sOchbIL8XDP0LOo0o2ZwynanPGNES9mfD/FmSZqT69dT6UGWBw6bZGAuaPkvqiMmovB3Nr3jM+ebSgaf5GYKGN++rrgW07Ba//oJbQcJ4r2xg+VpJ8cT5Je2ulOZSHoWXX9dNfW2q+PkqsuB2GUISzjRKA5VEnOFHFyb6LVqfdIWQvfc6wuAm45fD+ML6bYhn48dI/X845lE8EgHYl3PqUmBMaHzsa/Y3db+c2pIq98ql3RPLNAlLtzwbAmU1PVmnrmmM+MmGbngAxTAT4TUZ55DANP6eimlJbpl8mAF2KEjBIeI0tUpYxFWln6hbOMqo0CsLyoYGnPOspbHzkiTryV5UrJwKUypiK1K0Yy2+GfSHROLoS4mEV2vsczW77RoLSyhbOYk9k2OKKE5Xm3P+MA0wktExLKQ2QUxho=
